@startuml findTestsBySpecification

actor Teacher
participant "TestServiceImpl" as TestService
participant "TestRepository" as TestRepository
participant "TestSpecification" as TestSpec
participant "SubmitTestServiceImpl" as SubmitTestService

== Lược đồ tuần tự chức năng tìm kiếm danh sách bài kiểm tra ==
Teacher -> TestService: findTestsBySpecification(title, type, page, size, status, userId)
activate TestService

TestService -> TestService: create Pageable(page, size, Sort.by("serial"))
TestService --> TestService: Pageable
deactivate TestService

TestService -> TestSpec: hasTitle(title)
activate TestSpec
TestSpec --> TestService: Specification<Test>
deactivate TestSpec

alt Status is provided
    TestService -> TestSpec: hasStatus(status)
    activate TestSpec
    TestSpec --> TestService: Specification<Test>
    deactivate TestSpec
end

alt Type is provided
    TestService -> TestSpec: hasType(type)
    activate TestSpec
    TestSpec --> TestService: Specification<Test>
    deactivate TestSpec
end

TestService -> TestRepository: findAll(spec, pageable)
activate TestRepository
TestRepository --> TestService: Page<Test>
deactivate TestRepository

TestService -> TestService: convertToDTO(testPage)
activate TestService
TestService -> TestDTO: map each Test to TestDTO
TestService --> TestService: List<TestDTO>
deactivate TestService

TestService -> SubmitTestService: scoreLastSubmitTest(testId, userId)
activate SubmitTestService
SubmitTestService --> TestService: scoreLast
deactivate SubmitTestService

TestService --> Teacher: Page<TestDTO>
deactivate TestService

@enduml
