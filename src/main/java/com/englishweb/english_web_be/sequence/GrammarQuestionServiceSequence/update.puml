@startuml UpdateGrammarQuestion

actor User
participant "GrammarQuestionServiceImpl" as GQS
participant "GrammarQuestionRepository" as GQR
participant "BaseServiceImpl" as BSI

== Update Grammar Question ==
User -> GQS: update(dto, id)
activate GQS

GQS -> GQS: Check if serial is unique
alt Serial not unique
    GQS --> User: Throw DataIntegrityViolationException
    deactivate GQS
else Serial unique
    GQS -> BSI: Call super.update(dto, id)
    note right: Gọi hàm update từ BaseServiceImpl
    BSI -> GQS: Call convertToEntity(dto)
    note right: convertToEntity được định nghĩa trong BaseServiceImpl\nvà triển khai trong GrammarQuestionServiceImpl
    GQS --> BSI: Updated GrammarQuestion entity

    BSI -> GQR: Save updated GrammarQuestion entity
    activate GQR
    GQR --> BSI: Updated GrammarQuestion entity
    deactivate GQR

    BSI -> GQS: Call convertToDTO(updated entity)
    GQS --> BSI: Updated GrammarQuestionDTO
end

GQS --> User: Return updated GrammarQuestionDTO
deactivate GQS

@enduml
