@startuml UpdateListeningQuestion

actor User
participant "ListeningQuestionServiceImpl" as LQS
participant "ListeningQuestionRepository" as LQR
participant "BaseServiceImpl" as BSI

== Update Listening Question ==
User -> LQS: update(dto, id)
activate LQS

LQS -> LQS: Check if serial is unique
alt Serial not unique
    LQS --> User: Throw DataIntegrityViolationException
    deactivate LQS
else Serial unique
    LQS -> BSI: Call super.update(dto, id)
    note right: Gọi hàm update từ BaseServiceImpl
    BSI -> LQS: Call convertToEntity(dto)
    note right: convertToEntity được định nghĩa trong BaseServiceImpl\nvà triển khai trong ListeningQuestionServiceImpl
    LQS --> BSI: Updated ListeningQuestion entity

    BSI -> LQR: Save updated entity
    activate LQR
    LQR --> BSI: Updated entity
    deactivate LQR

    BSI -> LQS: Call convertToDTO(updated entity)
    LQS --> BSI: Updated ListeningQuestionDTO
end

LQS --> User: Return updated ListeningQuestionDTO
deactivate LQS

@enduml
